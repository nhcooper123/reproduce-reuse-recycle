---
title: "Summary stats and plots"
format: html
editor: visual
---

# Summaries for each variable
## Nov 2025

```{r, message = FALSE}
# Load libraries
library(tidyverse)
library(knitr)

# Build colour scheme for the journals
journal_cols <- c("#9FE2BF", # ESE
                  "#F4C430", # Functional Ecology
                  "#2AAA8A", # J Applied Ecology
                  "#C3B1E1", # J Animal Ecology
                  "#A7C7E7", # J Ecology
                  "#DE3163", # MEE
                  "#F2D2BD") # People and Nature
```

Read in the data
```{r}
papers <- read_csv("data/BES-data-code-hackathon-cleaned_2025-11-16.csv")
```

## How many distinct papers do we have data for? ----

```{r}
n_papers <- nrow(distinct(papers, paper_number))
n_papers
```

## Journals ----

### How many paper from each journal?

```{r}
journal_summary <-
  papers %>%
  group_by(journal) %>%
  summarise(count = n())

# Look at results
kable(journal_summary)
```

```{r}
# Quick plot
ggplot(journal_summary, aes(x = journal, y = count, fill = journal)) +
  geom_col() +
  theme_bw(base_size = 14) +
  scale_fill_manual(values = journal_cols) +
  coord_flip() +
  theme(legend.position = "none")
```  

## Years ----

### How many paper from each year?

```{r}
year_summary <-
  papers %>%
  group_by(year_published) %>%
  summarise(count = n())

# Look at results
kable(year_summary)
```

```{r}
# Quick plot
ggplot(year_summary, aes(x = year_published, y = count)) +
  geom_col(fill = "lightgrey") +
  theme_bw(base_size = 14)
```

## Article type ----

### How many of each article type?
```{r}
article_summary <-
  papers %>%
  group_by(article_type) %>%
  summarise(count = n())

# Look at results
kable(article_summary)
```

```{r}
# Quick plot
ggplot(article_summary, aes(x = article_type, y = count)) +
  geom_col(fill = "lightgrey") +
  theme_bw(base_size = 14) +
  coord_flip()
```

## Journal/article type/year ----

### How many papers from each journal ?

```{r}
paper_summary <-
  papers %>%
  group_by(journal, article_type, year_published) %>%
  summarise(count = n())

# Look at results
kable(paper_summary)
```

```{r}
# Quick plot
ggplot(paper_summary, aes(x = year_published, y = count, fill = journal)) +
  geom_col() +
  theme_bw(base_size = 14) +
  scale_fill_manual(values = journal_cols) +
  theme(legend.position = "none") +
  facet_wrap(~ journal) +
  theme(strip.background = element_rect(colour = "black", fill = "white"), 
        strip.text.x = element_text(size = 9))
``` 

[1] "paper_number"            "doi"                     "year_published"         
[4] "journal"                 "article_type"            "data_used"              
[7] "data_availability"       "data_availability_text"  "data_link"              
[10] "data_archive"            "data_doi"                "data_license"           
[13] "data_license_type"       "data_download"           "data_open"              
[16] "data_format"             "data_README"             "data_README_scale"      
[19] "data_completeness"       "code_used"               "code_alert"             
[22] "code_archived"           "code_availability"       "code_link"              
[25] "code_archive"            "code_doi"                "code_license"           
[28] "code_license_type"       "code_CITATION"           "code_download"          
[31] "code_open"               "code_format"             "code_language"          
[34] "code_README"             "code_README_scale"       "code_annotation_scale"  
[37] "code_vignette"           "code_Rpackage_available" "code_application_cited" 
[40] "code_comments"           "country_first"           "comments"               
[43] "recorder_ID"
# Data

## 1. How many papers have data? 
```{r}
data_by_journal <- 
  papers %>% 
  group_by(journal, data_used)

ggplot(data_by_journal, 
       aes(x = journal, fill = data_used)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  scale_fill_manual(values = c("#3b2f2f", "#56c8d3")) +
  theme_bw()
```

Note that any papers identified as not having data have been removed for any subsequent analysis.

## 2a. Is the data mentioned in the Data Availability statement?

```{r}
has_data_by_journal <- 
  papers %>% 
  filter(data_used == "Yes") %>% 
  select(journal, data_availability)

ggplot(has_data_by_journal, 
       aes(x = journal, fill = data_availability)) + 
  geom_bar(position = "fill") + 
  scale_fill_manual(values = c("#3b2f2f", "#f9cf57", "#56c8d3")) +
  coord_flip() + 
  theme_bw()
```

## 2b. Can the data be accessed via the link? 

```{r}
has_data_by_journal <- 
  papers %>% 
  filter(data_used == "Yes") %>% 
  select(journal, data_link) %>% 
  na.omit()

ggplot(has_data_by_journal, 
       aes(x = journal, fill = data_link)) + 
  geom_bar(position = "fill") + 
  scale_fill_manual(values = c("#3b2f2f", "#f9cf57", "#56c8d3")) +
  coord_flip() + 
  theme_bw()
```

## 2c. Can the data be downloaded? 

```{r}
has_data_by_journal <- 
  papers %>% 
  filter(data_used == "Yes") %>% 
  select(journal, data_download) %>% 
  na.omit()

ggplot(has_data_by_journal, 
       aes(x = journal, fill = data_download)) + 
  geom_bar(position = "fill") + 
  scale_fill_manual(values = c("#3b2f2f", "#faa773", "#56c8d3", "#f9cf57")) +
  coord_flip() + 
  theme_bw()
```

## 2d. Can the data be opened?
```{r}
has_data_by_journal <- 
  papers %>% 
  filter(data_used == "Yes") %>% 
  select(journal, data_open) %>% 
  na.omit()

ggplot(has_data_by_journal, 
       aes(x = journal, fill = data_open)) + 
  geom_bar(position = "fill") + 
  scale_fill_manual(values = c("#faa773", "#3b2f2f",  "#56c8d3", "#f9cf57")) +
  coord_flip() + 
  theme_bw()
```

## 3. What formats are the data stored in?

This will need some cleaning

```{r}
has_data_by_journal <- dat %>% 
  filter(data_used == "Yes") %>% 
  select(journal, data_format) %>% 
  
  
  
  df %>% 
  pivot_longer(cols = names(df)[1:3],
                    values_to = "newvar") %>% 
  select(newvar, ID)
  
  
  
  
  
  
  na.omit() %>% 
  mutate(data_format = case_when(
    data_format %in% c(".csv/tsv",
                       ".doc(x)",
                       ".nex",
                       ".odt",
                       ".ods",
                       ".pdf",
                       ".sql(ite)",
                       ".txt",
                       ".xls(x)") ~ data_format, 
    TRUE ~ "Other/Multiple"),
    data_format = factor(data_format, levels = c(".csv/tsv",
                       ".doc(x)",
                       ".nex",
                       ".odt",
                       ".ods",
                       ".pdf",
                       ".sql(ite)",
                       ".txt",
                       ".xls(x)", 
                       "Other/Multiple")))

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = data_format)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()
```

## 4. Where are the data archived? 

This is also going to require cleaning

```{r}
has_data_by_journal <- dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(journal = `4. Journal  (on spreadsheet)`,
         repo = `3. Where are the data archived?`) %>% 
  select(journal, repo) %>% 
  na.omit() %>% 
  mutate(repo = case_when(
    repo %in% c("DataVerse",
                "Dryad",
                "Figshare",
                "GBIF",
                "GitHub, GitLab, Codeberg or similar platform",
                "Institutional repository",
                "NCBI GenBank",
                "OSF",
                "Personal website",
                "Supplementary materials",
                "Zenodo") ~ repo, 
    TRUE ~ "Other/Multiple"
  ),
  repo = factor(repo, levels = c("DataVerse",
                "Dryad",
                "Figshare",
                "GBIF",
                "GitHub, GitLab, Codeberg or similar platform",
                "Institutional repository",
                "NCBI GenBank",
                "OSF",
                "Personal website",
                "Supplementary materials",
                "Zenodo",
                "Other/Multiple"))) 

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = repo)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()
```

## 5. Does the data have a license? Which?

```{r}
has_data_by_journal <- dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(journal = `4. Journal  (on spreadsheet)`,
         licence = `11. Does the data have a license?`) %>% 
  select(journal, licence) %>% 
  na.omit() %>% 
  mutate(licence = case_when(
    licence %in% c("Yes", "No", "Unsure") ~ licence, 
    TRUE ~ "Other"),
    licence = factor(licence, 
                     levels = c("Other", "Unsure", "No", "Yes")))

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = licence)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()
```

Top 10 licence types: 

```{r}
dat %>% 
  rename(licence = "12. If yes, what license?") %>%
  filter(!is.na(licence)) %>% 
  group_by(licence) %>% 
  summarise(count = n()) %>% 
  arrange(-count) %>% 
  slice(1:10) %>% 
  kable()
```


## 6. Does the data have a DOI

```{r}
has_data_by_journal <- dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(journal = `4. Journal  (on spreadsheet)`,
         doi = `4. Does the dataset have a DOI?`) %>% 
  select(journal, doi) %>% 
  na.omit() %>% 
  mutate(doi = case_when(
    doi %in% c("Yes", 
                   "No", 
                   "Unsure", 
                   "Yes but DOI not found/incorrect") ~ doi, 
    TRUE ~ "Other"),
    doi = factor(doi, levels = c("Other", "Unsure", "No", "Yes but DOI not found/incorrect", "Yes")))

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = doi)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()
```

## 7. Has the data been cited? 

```{r}
has_data_by_journal <- dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(journal = `4. Journal  (on spreadsheet)`,
         cited = `15. Has the data been cited by someone other than the original authors? You can find this by clicking on the citations and looking at the papers that cite the data.`) %>% 
  select(journal, cited) %>% 
  na.omit() %>% 
  mutate(cited = case_when(
    cited %in% c("Yes","No", "Unsure") ~ cited, 
    TRUE ~ "Other"),
    cited = factor(cited, levels = c("Other", "Unsure", "No", "Yes")))

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = cited)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()
```

```{r}
dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(doi = `2. DOI of paper (please copy paste to avoid errors)`, journal = `4. Journal  (on spreadsheet)`,
         cited = `16. If yes, how many times? (excluding the original paper it was archived for) Enter number or Unclear`) %>% 
  select(journal, doi, cited) %>%
  filter(!cited %in% c(
    "NULL", "Unsure", "Unclear", "N/A", "0")
    ) %>% 
  mutate(cited = as.numeric(cited)) %>% 
  na.omit() %>%
  arrange(-cited) %>% 
  kable()
```


## 8a. Does the data have a readme? 

```{r}
has_data_by_journal <- dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(journal = `4. Journal  (on spreadsheet)`,
         readme = `8. Does the data have a README/metadata?`) %>% 
  select(journal, readme) %>%
  na.omit() %>% 
  mutate(readme = case_when(
    readme %in% c("Yes", "No", "Unsure") ~ readme, 
    TRUE ~ "Other"),
    readme = factor(readme, levels = c("Other", "Unsure", "No", "Yes")))

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = readme)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()
```
## 8b. How useful is the readme? 

```{r}
has_data_by_journal <- dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(journal = `4. Journal  (on spreadsheet)`,
         readme = `9. How useful is the README/metadata? Read the notes in the protocol to help with decisions here. SKIP THIS Q IF NO README EXISTS.`) %>% 
  select(journal, readme) %>% 
  mutate(readme_useful = as.factor(readme)) %>% 
  na.omit()

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = readme_useful)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()

has_data_by_journal %>% 
  group_by(journal) %>% 
  summarise(`Average README usefulness` = mean(readme, na.rm = TRUE)) %>% 
  arrange(-`Average README usefulness`) %>% 
  kable()

```

## 9. How complete are the archived data? 
```{r}
has_data_by_journal <- dat %>% 
  filter(`7. Does the paper have data?` == "Yes") %>% 
  rename(journal = `4. Journal  (on spreadsheet)`,
         data_complete = `10. How complete is the archived data?`) %>% 
  select(journal, data_complete) %>% 
  na.omit() %>% 
  mutate(data_complete = case_when(
    data_complete == "The main analyses of the paper cannot be repeated with the data that has been archived." ~ "No",
    data_complete == "Some analyses can be repeated but not all (~50% of analyses can be repeated)." ~ "50%",
    data_complete == "Most data are provided with only small omissions, for example exploratory analyses (~75% of analyses can be repeated)." ~ "75%",
    data_complete == "All the data necessary to reproduce all analyses and results are archived." ~ "100%",
    data_complete == "Unsure" ~ "Unsure",
    TRUE ~ "Other")) 

ggplot(has_data_by_journal, 
       aes(x = journal,
           fill = data_complete)) + 
  geom_bar(position = "fill") + 
  coord_flip() + 
  theme_bw()
```

# Validation

```{r}
val_dat <- filter(dat, `1. Paper number` == "2272")

```

